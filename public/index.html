<!DOCTYPE html>
<html lang='en-US'>
  <head>
    <meta charset='utf-8'/>
    <meta
      name='viewport'
      content='width=device-width, initial-scale=1, shrink-to-fit=no'
    />

    <title>Dilution Buddy</title>
    <link
      rel='stylesheet'
      type='text/css'
      href='https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css'
      integrity='sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T'
      crossorigin='anonymous'
    />
  </head>

  <body class='bg-dark'>
    <br/>
    <div class='container'>
      <div class='card'>
        <div class='card-header'>
          <b>Dilution Buddy</b>
        </div><!-- card-header -->

        <div class='card-body'>
          <p>
            Enter values in the <b>Initial Concentration</b>,
            <b>Initial Volume</b>, and <b>Desired Concentration</b>
            fields.  The amount of solvent to add will be shown in the
            <b>Solvent Volume</b> field.
          </p>

          <div class='row'>
            <div class='col'>
              <div class='form-group'>
                <label
                  for='c0'
                  title='Initial concentration (percentage).'
                >
                  Initial Concentration
                </label><br/>

                <div class='input-group'>
                  <input
                    type='number'
                    id='c0'
                    class='form-control is-valid'
                    title='Initial concentration (percentage).'
                    value='99.8'
                    min='0'
                    max='100'
                    step='0.1'
                    required
                  />

                  <div class='input-group-append'>
                    <span class='input-group-text'>%</span>
                  </div><!-- input-group-append -->

                  <div id='c0-invalid' class='invalid-feedback'>
                    Error
                  </div>
                </div><!-- input-group -->

                <p class='form-text text-muted'>
                  The initial concentration, as a percentage.
                </p><!-- form-text -->
              </div><!-- form-group -->
            </div><!-- col -->

            <div class='col'>
              <div class='form-group'>
                <label
                  for='v0'
                  title='Initial volume (liters, gallons, etc).'
                >
                  Initial Volume
                </label><br/>

                <input
                  type='number'
                  id='v0'
                  class='form-control is-valid'
                  title='Initial volume (liters, gallons, etc).'
                  value='7'
                  min='0'
                  required
                />

                <div id='v0-invalid' class='invalid-feedback'>
                  Error
                </div>

                <p class='form-text text-muted'>
                  The initial volume.  The unit doesn't matter (liters,
                  gallons, etc).
                </p><!-- form-text -->
              </div><!-- form-group -->
            </div><!-- col -->
          </div><!-- row -->

          <div class='row'>
            <div class='col'>
              <div class='form-group'>
                <label
                  for='c1'
                  title='Desired concentration (percentage).'
                >
                  Desired Concentration
                </label><br/>

                <div class='input-group'>
                  <input
                    type='number'
                    id='c1'
                    class='form-control'
                    title='Desired concentration (percentage).'
                    value='70'
                    min='0'
                    max='100'
                    step='0.1'
                    required
                  />

                  <div class='input-group-append'>
                    <span class='input-group-text'>%</span>
                  </div><!-- input-group-append -->

                  <div id='c1-invalid' class='invalid-feedback'>
                    Error
                  </div>
                </div><!-- input-group -->

                <p class='form-text text-muted'>
                  The desired concentration, as a percentage.
                </p><!-- form-text -->
              </div><!-- form-group -->
            </div><!-- col -->
          </div><!-- row -->

          <div class='row'>
            <div class='col'>
              <div class='form-group'>
                <label
                  for='vs'
                  title='Volume of solvent (liters, gallons, etc).'
                >
                  <b>Solvent Volume</b>
                </label><br/>

                <input
                  type='text'
                  id='vs'
                  class='form-control is-valid'
                  title='Volume of solvent (liters, gallons, etc).'
                  value=''
                  readonly
                />

                <div class='invalid-feedback'>
                  Please correct the errors above.
                </div>

                <p class='form-text text-muted'>
                  The volume of solvent to mix with the original
                  solution.
                </p><!-- form-text -->
              </div><!-- form-group -->
            </div><!-- col -->

            <div class='col'>
              <div class='form-group'>
                <label
                  for='v1'
                  title='Total output volume (liters, gallons, etc).'
                >
                  Output Volume
                </label><br/>

                <input
                  type='text'
                  id='v1'
                  class='form-control is-valid'
                  title='Total output volume (liters, gallons, etc).'
                  value=''
                  readonly
                />

                <div class='invalid-feedback'>
                  Please correct the errors above.
                </div>

                <p class='form-text text-muted'>
                  The total volume that you will have when finished.
                </p><!-- form-text -->
              </div><!-- form-group -->
            </div><!-- col -->
          </div><!-- row -->
        </div><!-- card-body -->

        <div class='card-body'>
          <p>
            <b>Steps</b>
          </p>

          <table class='table table-hover'>
            <thead>
              <th>Step</th>
              <th>Description</th>
            </thead>

            <tbody>
              <tr>
                <td>
                  C<sub>0</sub> &sdot; V<sub>0</sub> = C<sub>1</sub> &sdot; V<sub>1</sub>
                </td>

                <td>
                  <a
                    href='https://en.wikipedia.org/wiki/Dilution_(equation)'
                    target='_blank'
                    title='View dilution equation on Wikipedia.'
                  >Dilution equation (Wikipedia)</a>
                </td>
              </tr>

              <tr>
                <td>
                  V<sub>1</sub> = C<sub>0</sub> &sdot; V<sub>0</sub> / C<sub>1</sub>
                </td>

                <td>
                  Solve for V<sub>1</sub>
                </td>
              </tr>

              <tr>
                <td>
                  V<sub>s</sub> = V<sub>1</sub> - V<sub>0</sub>
                </td>

                <td>
                  Calculate volume of solvent
                </td>
              </tr>
            </tbody>

            <caption>
              Steps to calculate volume of solvent needed to dilute a
              given volume and concentration to a given desired
              concentration.
            </caption>
          </table>

          <ul class='nav justify-content-center'>
            <li class='nav-item'>
              <a
                href='https://github.com/pablotron/dilute'
                class='nav-link'
                target='_blank'
                title='GitHub repository.'
              >GitHub Repository</a>
            </li><!-- nav-item -->

            <li class='nav-item'>
              <a
                href='https://github.com/pablotron/dilute/issues'
                class='nav-link'
                target='_blank'
                title='File a bug.'
              >Report a Bug</a>
            </li><!-- nav-item -->
          </ul><!-- nav -->
        </div><!-- card-body -->
      </div><!-- card -->
    </div><!-- container -->

    <script type='text/javascript'>
      document.addEventListener('DOMContentLoaded', function() {
        function get(id) {
          return document.getElementById(id);
        }

        function get_vals() {
          var c0 = +(get('c0').value),
              c1 = +(get('c1').value),
              v0 = +(get('v0').value),
              v1 = (c0 * v0) / c1;
          return {
            c0: c0,
            c1: c1,
            v0: v0,
            v1: v1,
            vs: (v1 - v0),
          };
        }

        function check(r) {
          var errs = [];

          // check c0
          if (r.c0 <= 0 || r.c0 > 100) {
            errs.push({
              id:   'c0',
              text: 'Initial concentration must be between 0 and 100',
            });
          }

          // check c1
          if (r.c1 <= 0 || r.c1 > 100) {
            errs.push({
              id:   'c1',
              text: 'Desired concentration be between 0 and 100',
            });
          }

          // check c1 > c0
          if (r.c1 > r.c0) {
            errs.push({
              id:   'c1',
              text: 'Desired concentration cannot be greater than initial concentration.',
            });
          }

          // check v0
          if (r.v0 <= 0) {
            errs.push({
              id:   'v0',
              text: 'Initial volume be greater than zero',
            });
          }

          // return errors
          return errs;
        }

        var IDS = ['c0', 'c1', 'v0', 'v1', 'vs'];

        function update() {
          setTimeout(function() {
            var r = get_vals(),
                errs = check(r);

            // clear errors
            IDS.forEach(function(id) {
              var css = get(id).classList;
              css.remove('is-invalid');
              css.add('is-valid');
              // get(id + '-invalid').classList.add('hidden');
            });

            if (errs.length > 0) {
              // show errors
              errs.forEach(function(row) {
                var css = get(row.id).classList;
                css.remove('is-valid');
                css.add('is-invalid');
                get(row.id + '-invalid').innerText = row.text;
              });

              ['v1', 'vs'].forEach(function(id) {
                var css = get(id).classList;
                css.remove('is-valid');
                css.add('is-invalid');
              });

              // clear results
              get('vs').value = 'n/a';
              get('v1').value = 'n/a';
            } else {
              // no errors, calculate values
              get('vs').value = r.vs.toFixed(1);
              get('v1').value = r.v1.toFixed(1);
            }
          }, 10);
        }

        ['c0', 'v0', 'c1'].forEach(function(id) {
          get(id).addEventListener('keydown', update);
        });

        // initial update, focus concentration
        update();
        get('c1').focus();
      });
    </script>
  </body>
</html>

